# 考试系统功能升级计划

## 1. 数据库迁移（文件系统 → PostgreSQL + Drizzle ORM）

### 分析
目前系统使用文件系统存储试卷与试题数据，需要迁移到PostgreSQL数据库，并使用Drizzle ORM进行管理。

### 子任务
- [x] **数据库设计**
  - [x] 设计试卷表结构（exams）
  - [x] 设计试题表结构（questions）
  - [x] 设计选项表结构（options）
  - [x] 设计用户答案表结构（user_answers）
  - [x] 设计试卷配置表结构（exam_configs）
  
- [x] **Drizzle ORM设置**
  - [x] 安装必要依赖（`pnpm add drizzle-orm pg @vercel/postgres`）
  - [x] 配置Drizzle ORM连接
  - [x] 创建schema定义
  - [x] 编写迁移脚本

- [x] **数据迁移**
  - [x] 编写数据导入工具，将现有JSON文件数据迁移到数据库
  - [x] 数据验证和完整性检查
  
- [ ] **数据库部署**
  - [ ] 选择数据库部署方案（阿里云RDS、自建ECS或容器化）
  - [ ] 容器化部署配置
    - [ ] 创建/修改docker-compose.yml添加PostgreSQL服务
    - [ ] 修改Dockerfile确保依赖安装
    - [ ] 创建数据库等待脚本保证应用正确启动顺序
    - [ ] 配置数据持久化卷
    
  - [ ] 生产环境配置
    - [ ] 创建生产环境专用配置文件（docker-compose.prod.yml）
    - [ ] 设置环境变量和密钥管理
    - [ ] 配置备份策略和恢复方案
  - [ ] 部署流程自动化
    - [ ] 编写自动化部署脚本
    - [ ] 配置CI/CD流程集成数据库迁移
  
- [ ] **API改造**
  - [ ] 修改试卷管理API（/api/testField/config/experiment/examTypes/route.ts）
  - [ ] 修改题目管理API（/api/testField/config/experiment/questions/route.ts）
  - [ ] 添加数据库事务支持，确保操作原子性

- [ ] **前端适配**
  - [ ] 更新试卷管理页面（/testField/experiment/config）
  - [ ] 更新试卷页面（/testField/experiment）

## 2. 考试计时功能（倒计时/正计时）

### 分析
需要添加考试计时功能，支持倒计时和正计时两种模式，并允许在配置页面为不同试卷设置不同的计时模式。

### 子任务
- [ ] **数据模型更新**
  - [ ] 在试卷配置表中添加计时相关字段（timer_mode, timer_duration）
  - [ ] 更新API以支持计时配置的存取

- [ ] **计时组件开发**
  - [ ] 创建通用计时器组件（支持正计时和倒计时）
  - [ ] 实现计时暂停/继续功能
  - [ ] 实现时间到期自动提交功能（倒计时模式）
  - [ ] 支持时间格式化显示（小时:分钟:秒）

- [ ] **配置界面集成**
  - [ ] 在试卷配置页面添加计时设置区域
  - [ ] 实现计时模式切换（正计时/倒计时）
  - [ ] 提供时间长度设置（用于倒计时）

- [ ] **考试页面集成**
  - [ ] 在考试页面集成计时器组件
  - [ ] 根据配置自动启用适当的计时模式
  - [ ] 实现时间保存，页面刷新后继续计时

## 3. 主题颜色切换

### 分析
需要支持考试系统主题颜色切换，并能在配置页面为不同试卷设置不同的主题。

### 子任务
- [ ] **主题系统设计**
  - [ ] 设计基础主题变量（颜色、字体、间距等）
  - [ ] 创建多种预定义主题（明亮、暗黑、蓝色、绿色等）
  - [ ] 创建主题切换机制

- [ ] **样式系统改造**
  - [ ] 将现有CSS转换为基于主题变量的样式
  - [ ] 实现动态主题加载和切换功能
  - [ ] 确保所有组件响应主题变化

- [ ] **主题配置功能**
  - [ ] 在试卷配置表中添加主题相关字段（theme）
  - [ ] 在配置界面添加主题预览和选择功能
  - [ ] 更新API以支持主题配置的存取

- [ ] **用户界面适配**
  - [ ] 确保所有元素适配不同主题
  - [ ] 提供主题预览功能

## 4. 试题解析配置

### 分析
需要添加试题解析功能，允许配置每道题的解析内容，在用户答题后展示。

### 子任务
- [ ] **数据模型更新**
  - [ ] 在试题表中添加解析字段（explanation, explanation_resource）
  - [ ] 更新API以支持解析内容的存取

- [ ] **解析编辑功能**
  - [ ] 在题目编辑界面添加解析编辑区域
  - [ ] 支持富文本编辑（加粗、斜体、列表等）
  - [ ] 支持图片插入

- [ ] **解析展示功能**
  - [ ] 创建解析展示组件
  - [ ] 在答题结果页面集成解析展示
  - [ ] 支持按题查看解析
  - [ ] 添加显示/隐藏解析的控制

## 5. 音视频组件集成

### 分析
需要在题目和选项中支持音视频内容。

### 子任务
- [ ] **数据模型更新**
  - [ ] 在试题和选项表中添加媒体类型和URL字段（media_type, media_url）
  - [ ] 更新API以支持媒体内容的存取

- [ ] **媒体上传和管理**
  - [ ] 创建媒体上传组件
  - [ ] 实现媒体文件存储方案（可考虑使用云存储）
  - [ ] 添加媒体管理功能（预览、删除）

- [ ] **播放器组件开发**
  - [ ] 创建通用音频播放器组件
  - [ ] 创建通用视频播放器组件
  - [ ] 支持播放控制（播放、暂停、音量调节）

- [ ] **编辑界面集成**
  - [ ] 在题目和选项编辑界面添加媒体上传和预览功能
  - [ ] 支持不同媒体类型的选择（图片、音频、视频）

- [ ] **考试界面集成**
  - [ ] 在考试页面集成媒体播放器
  - [ ] 优化移动端播放体验

## 6. 考试系统提示组件

### 分析
需要添加考试系统提示组件，提供操作指导和反馈。

### 子任务
- [ ] **提示组件设计**
  - [ ] 设计不同类型的提示组件（信息、警告、错误、成功）
  - [ ] 创建全局提示管理机制
  - [ ] 支持自动消失和手动关闭

- [ ] **提示触发场景**
  - [ ] 定义需要提示的关键场景（保存成功、操作错误、时间提醒等）
  - [ ] 实现提示触发逻辑

- [ ] **提示内容配置**
  - [ ] 支持自定义提示内容
  - [ ] 多语言支持（可选）

- [ ] **用户界面集成**
  - [ ] 在考试页面集成提示组件
  - [ ] 在配置页面集成提示组件

## 实施计划

### 阶段一：基础架构调整
- 数据库迁移
- 主题系统框架搭建

### 阶段二：核心功能增强
- 计时功能实现
- 试题解析功能

### 阶段三：媒体和用户体验
- 音视频组件集成
- 提示组件开发

### 阶段四：测试和优化
- 功能测试
- 性能优化
- 用户体验完善 