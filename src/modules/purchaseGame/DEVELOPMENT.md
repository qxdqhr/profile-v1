# 购买游戏模块开发文档

## 模块概述
这是一个购买商品的小游戏模块，玩家需要在倒计时内做出购买决策，每次购买都会影响生命值或源石锭。

## 功能需求
1. **游戏界面元素**：
   - 倒计时进度条（画面上部）
   - 人物立绘展示（画面中间）
   - 操作按钮区域（购买/不买）
   - 状态显示（剩余生命、剩余源石锭）

2. **游戏机制**：
   - 每次点击购买按钮会购买商品
   - 商品类型：谋财（扣减源石锭）、害命（扣减生命值）
   - 商品每次都会变化
   - 生命值为0时游戏结束，显示总积分

3. **技术实现**：
   - 前端：React + TypeScript + Tailwind CSS
   - 后端：Next.js API Routes
   - 数据库：Drizzle ORM + PostgreSQL

## 开发步骤

### 第一步：创建模块基础结构
- [x] 创建模块目录结构
- [x] 创建开发文档
- [x] 创建类型定义
- [x] 创建数据库schema

### 第二步：创建数据库结构
- [x] 创建游戏记录表
- [x] 创建商品配置表
- [x] 创建用户游戏状态表

### 第三步：创建后端API
- [x] 创建游戏初始化API
- [x] 创建购买操作API
- [x] 创建游戏结算API

### 第四步：创建前端组件
- [x] 创建游戏主页面
- [x] 创建倒计时组件
- [x] 创建人物立绘组件
- [x] 创建操作按钮组件
- [x] 创建结算弹窗组件

### 第五步：创建Hook和服务
- [x] 创建游戏状态管理Hook
- [x] 创建游戏服务类
- [x] 创建游戏配置服务

### 第六步：集成和测试
- [x] 集成到主应用
- [x] 添加路由配置
- [x] 测试游戏流程

## 目录结构
```
purchaseGame/
├── api/                    # API路由
│   ├── init/              # 游戏初始化
│   ├── purchase/          # 购买操作
│   └── settle/            # 游戏结算
├── components/            # 前端组件
│   ├── GamePage.tsx       # 游戏主页面
│   ├── CountdownBar.tsx   # 倒计时进度条
│   ├── CharacterDisplay.tsx # 人物立绘
│   ├── GameControls.tsx   # 操作按钮
│   └── SettlementModal.tsx # 结算弹窗
├── db/                    # 数据库相关
│   └── schema.ts          # 数据库schema
├── hooks/                 # 自定义Hook
│   └── usePurchaseGame.ts # 游戏状态管理
├── services/              # 服务层
│   ├── gameService.ts     # 游戏服务
│   └── configService.ts   # 配置服务
├── types/                 # 类型定义
│   └── index.ts           # 类型导出
├── pages/                 # 页面组件
│   └── page.tsx           # 游戏页面
├── index.ts               # 模块导出
└── DEVELOPMENT.md         # 开发文档
```

## 游戏配置
- 初始生命值：3
- 初始源石锭：100
- 倒计时时间：30秒
- 商品类型：谋财（扣减源石锭）、害命（扣减生命值）
- 商品价值范围：10-50源石锭或1-2生命值

## 更新日志
- 2024-01-15：创建模块基础结构
- 2024-01-15：完成所有开发步骤，模块已可正常使用
- 2024-01-15：优化游戏结束逻辑，当购买扣减生命值为0的物品时立即结束游戏
- 2024-01-15：将游戏规则部分改造成帮助弹窗组件，提升用户体验 